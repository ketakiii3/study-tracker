<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="StudyFlow">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <title>StudyFlow - Academic Tracker</title>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
      });
    }
  </script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #f7f8fb;
      --bg-secondary: #ffffff;
      --bg-tertiary: #eef1f7;
      --bg-card: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(240, 243, 250, 0.95) 100%);
      --text-primary: #1c2230;
      --text-secondary: #4b5565;
      --text-muted: #7b8699;
      --accent-purple: #c9b6ff;
      --accent-blue: #a7d4ff;
      --accent-green: #a9e9d2;
      --accent-orange: #ffcaa3;
      --accent-pink: #f7b7d3;
      --accent-red: #f7a6a6;
      --accent-yellow: #ffe6a7;
      --border-subtle: rgba(17, 24, 39, 0.06);
      --border-medium: rgba(17, 24, 39, 0.12);
      --glass: rgba(255, 255, 255, 0.6);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
    }
    
    html { height: -webkit-fill-available; }
    
    body {
      font-family: 'Instrument Sans', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: -webkit-fill-available;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    #root { min-height: 100vh; }
    
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border-medium); border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect, createContext, useContext, useRef } = React;
    const { motion, AnimatePresence, useInView } = Motion;
    
    // ============ DATA CONTEXT ============
    const DataContext = createContext();
    
    const defaultCourses = [
      { id: '1', code: 'COMS6706E', name: 'Advanced Spoken Language Processing', color: '#c9b6ff' },
      { id: '2', code: 'COMS6998E', name: 'Topics in Computer Science', color: '#a7d4ff' },
      { id: '3', code: 'STAT4243GU', name: 'Applied Data Science', color: '#a9e9d2' },
      { id: '4', code: 'COMS4111W', name: 'Introduction to Databases', color: '#ffcaa3' },
    ];
    
    const assignmentTypes = ['Reading', 'Homework', 'Prelab', 'Lab Report', 'Presentation', 'Project', 'Paper', 'Quiz', 'Exam'];
    const statusOptions = ['Not Started', 'In Progress', 'Complete', 'Submitted'];
    
    const DataProvider = ({ children }) => {
      const [courses, setCourses] = useState(() => {
        try { return JSON.parse(localStorage.getItem('studyflow_courses')) || defaultCourses; } catch { return defaultCourses; }
      });
      const [assignments, setAssignments] = useState(() => {
        try { return JSON.parse(localStorage.getItem('studyflow_assignments')) || []; } catch { return []; }
      });
      const [jobPrep, setJobPrep] = useState(() => {
        try { return JSON.parse(localStorage.getItem('studyflow_jobprep')) || { resumes: [], coverLetters: [], templates: [], applications: [], studyTopics: [] }; } catch { return { resumes: [], coverLetters: [], templates: [], applications: [], studyTopics: [] }; }
      });
      const [grades, setGrades] = useState(() => {
        try { return JSON.parse(localStorage.getItem('studyflow_grades')) || []; } catch { return []; }
      });
      
      useEffect(() => { localStorage.setItem('studyflow_courses', JSON.stringify(courses)); }, [courses]);
      useEffect(() => { localStorage.setItem('studyflow_assignments', JSON.stringify(assignments)); }, [assignments]);
      useEffect(() => { localStorage.setItem('studyflow_jobprep', JSON.stringify(jobPrep)); }, [jobPrep]);
      useEffect(() => { localStorage.setItem('studyflow_grades', JSON.stringify(grades)); }, [grades]);
      
      return (
        <DataContext.Provider value={{ courses, setCourses, assignments, setAssignments, jobPrep, setJobPrep, grades, setGrades, assignmentTypes, statusOptions }}>
          {children}
        </DataContext.Provider>
      );
    };
    
    const useData = () => useContext(DataContext);
    
    // ============ TYPEWRITER EFFECT ============
    const TypewriterText = ({ text, delay = 0, speed = 50 }) => {
      const [displayText, setDisplayText] = useState('');
      const [started, setStarted] = useState(false);
      
      useEffect(() => {
        const t = setTimeout(() => setStarted(true), delay);
        return () => clearTimeout(t);
      }, [delay]);
      
      useEffect(() => {
        if (!started) return;
        let i = 0;
        const timer = setInterval(() => {
          if (i <= text.length) { setDisplayText(text.slice(0, i)); i++; }
          else { clearInterval(timer); }
        }, speed);
        return () => clearInterval(timer);
      }, [started, text, speed]);
      
      return <span>{displayText}<motion.span animate={{ opacity: [1, 0] }} transition={{ duration: 0.5, repeat: Infinity }} style={{ borderRight: displayText.length < text.length ? '2px solid var(--accent-purple)' : 'none', marginLeft: '2px' }} /></span>;
    };
    
    // ============ STAGGER ANIMATIONS ============
    const StaggerContainer = ({ children, delay = 0.08 }) => (
      <motion.div initial="hidden" animate="visible" variants={{ hidden: { opacity: 0 }, visible: { opacity: 1, transition: { staggerChildren: delay } } }}>
        {children}
      </motion.div>
    );
    
    const StaggerItem = ({ children }) => (
      <motion.div variants={{ hidden: { opacity: 0, y: 20, scale: 0.95 }, visible: { opacity: 1, y: 0, scale: 1, transition: { type: "spring", stiffness: 100, damping: 15 } } }}>
        {children}
      </motion.div>
    );
    
    // ============ CARD STACK ============
    const CardStack = ({ children }) => (
      <div>
        {React.Children.map(children, (child, i) => (
          <motion.div
            initial={{ opacity: 0, y: 30, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            transition={{ delay: i * 0.08, type: "spring", stiffness: 120, damping: 20 }}
            whileHover={{ scale: 1.02, y: -3, transition: { duration: 0.2 } }}
            style={{ marginBottom: '10px' }}
          >
            {child}
          </motion.div>
        ))}
      </div>
    );
    
    // ============ FADE IN VIEW ============
    const FadeInView = ({ children, delay = 0 }) => {
      const ref = useRef(null);
      const isInView = useInView(ref, { once: true, margin: "-30px" });
      return (
        <motion.div ref={ref} initial={{ opacity: 0, y: 20 }} animate={isInView ? { opacity: 1, y: 0 } : {}} transition={{ duration: 0.5, delay }}>
          {children}
        </motion.div>
      );
    };
    
    // ============ ICONS ============
    const Icons = {
      home: <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>,
      book: <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
      briefcase: <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
      chart: <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>,
      calendar: <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      plus: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      check: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20,6 9,17 4,12"/></svg>,
      x: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      trash: <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3,6 5,6 21,6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
      clock: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>,
      search: <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
    };
    
    // ============ COMPONENTS ============
    const Card = ({ children, style = {}, ...props }) => (
      <motion.div
        whileHover={{ y: -3, rotateX: 2, rotateY: -2, transformPerspective: 800 }}
        transition={{ type: "spring", stiffness: 200, damping: 20 }}
        style={{ background: 'var(--bg-card)', borderRadius: 'var(--radius-lg)', border: '1px solid var(--border-subtle)', backdropFilter: 'blur(20px)', transformStyle: 'preserve-3d', ...style }}
        {...props}
      >
        {children}
      </motion.div>
    );
    
    const Button = ({ children, variant = 'primary', size = 'md', style = {}, onClick, ...props }) => {
      const variants = {
        primary: { background: 'linear-gradient(135deg, #c9b6ff 0%, #818cf8 100%)', color: '#fff', border: 'none' },
        secondary: { background: 'var(--glass)', color: 'var(--text-primary)', border: '1px solid var(--border-medium)' },
        ghost: { background: 'transparent', color: 'var(--text-secondary)', border: 'none' },
      };
      const sizes = { sm: { padding: '8px 14px', fontSize: '13px' }, md: { padding: '12px 20px', fontSize: '14px' }, lg: { padding: '16px 28px', fontSize: '16px' } };
      
      return (
        <motion.button
          whileHover={{ scale: 1.03, y: -1, rotateX: 2, rotateY: -2, transformPerspective: 800, boxShadow: '0 8px 24px rgba(201, 182, 255, 0.28)' }}
          whileTap={{ scale: 0.97, rotateX: 0, rotateY: 0, transformPerspective: 800 }}
          onClick={onClick}
          style={{ ...variants[variant], ...sizes[size], borderRadius: 'var(--radius-md)', fontFamily: 'inherit', fontWeight: 600, cursor: 'pointer', display: 'inline-flex', alignItems: 'center', justifyContent: 'center', gap: '8px', ...style }}
          {...props}
        >{children}</motion.button>
      );
    };
    
    const Input = ({ label, style = {}, ...props }) => (
      <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>
        {label && <label style={{ fontSize: '13px', color: 'var(--text-secondary)', fontWeight: 500 }}>{label}</label>}
        <input style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '12px 16px', color: 'var(--text-primary)', fontSize: '14px', fontFamily: 'inherit', outline: 'none', width: '100%', ...style }} {...props} />
      </div>
    );
    
    const Select = ({ label, options, style = {}, ...props }) => (
      <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>
        {label && <label style={{ fontSize: '13px', color: 'var(--text-secondary)', fontWeight: 500 }}>{label}</label>}
        <select style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '12px 16px', color: 'var(--text-primary)', fontSize: '14px', fontFamily: 'inherit', outline: 'none', cursor: 'pointer', width: '100%', ...style }} {...props}>
          {options.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}
        </select>
      </div>
    );
    
    const TextArea = ({ label, style = {}, ...props }) => (
      <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>
        {label && <label style={{ fontSize: '13px', color: 'var(--text-secondary)', fontWeight: 500 }}>{label}</label>}
        <textarea style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '12px 16px', color: 'var(--text-primary)', fontSize: '14px', fontFamily: 'inherit', outline: 'none', resize: 'vertical', minHeight: '80px', width: '100%', ...style }} {...props} />
      </div>
    );
    
    const Badge = ({ children, color = '#c9b6ff' }) => (
      <span style={{ display: 'inline-flex', padding: '4px 10px', borderRadius: '20px', fontSize: '11px', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '0.5px', background: `${color}20`, color: color, border: `1px solid ${color}40` }}>{children}</span>
    );
    
    const StatusBadge = ({ status }) => {
      const colors = { 'Not Started': '#71717a', 'In Progress': '#a7d4ff', 'Complete': '#a9e9d2', 'Submitted': '#c9b6ff' };
      return <Badge color={colors[status] || '#71717a'}>{status}</Badge>;
    };
    
    // ============ MODAL - FIXED & CENTERED ============
    const Modal = ({ isOpen, onClose, title, children }) => {
      useEffect(() => {
        if (isOpen) document.body.style.overflow = 'hidden';
        else document.body.style.overflow = '';
        return () => { document.body.style.overflow = ''; };
      }, [isOpen]);
      
      return (
        <AnimatePresence>
          {isOpen && (
            <>
              <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
                onClick={onClose}
                style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0, 0, 0, 0.85)', backdropFilter: 'blur(10px)', zIndex: 1000 }}
              />
              <div style={{ position: 'fixed', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '24px 20px 120px', zIndex: 1001, pointerEvents: 'none' }}>
                <motion.div
                  initial={{ opacity: 0, scale: 0.9, y: -30 }}
                  animate={{ opacity: 1, scale: 1, y: 0 }}
                  exit={{ opacity: 0, scale: 0.9, y: -30 }}
                  transition={{ type: "spring", stiffness: 300, damping: 30 }}
                  style={{
                    background: 'var(--bg-secondary)',
                    borderRadius: 'var(--radius-xl)',
                    border: '1px solid var(--border-medium)',
                    padding: '24px',
                    width: 'calc(100% - 40px)',
                    maxWidth: '420px',
                    maxHeight: '100%',
                    overflow: 'auto',
                    pointerEvents: 'auto',
                    boxShadow: '0 25px 60px -15px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(167, 139, 250, 0.1)',
                  }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                    <motion.h2 initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} style={{ fontFamily: "'Fraunces', serif", fontSize: '20px', fontWeight: 600 }}>{title}</motion.h2>
                    <motion.button whileHover={{ scale: 1.1, rotate: 90 }} whileTap={{ scale: 0.9 }} onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', padding: '4px' }}>{Icons.x}</motion.button>
                  </div>
                  {children}
                </motion.div>
              </div>
            </>
          )}
        </AnimatePresence>
      );
    };
    
    // ============ NAVIGATION ============
    const Navigation = ({ activeTab, setActiveTab }) => {
      const tabs = [
        { id: 'dashboard', icon: Icons.home, label: 'Home' },
        { id: 'assignments', icon: Icons.book, label: 'Tasks' },
        { id: 'calendar', icon: Icons.calendar, label: 'Calendar' },
        { id: 'jobprep', icon: Icons.briefcase, label: 'Career' },
        { id: 'grades', icon: Icons.chart, label: 'Grades' },
      ];
      
      return (
        <nav style={{ position: 'fixed', bottom: 0, left: 0, right: 0, background: 'linear-gradient(to top, var(--bg-primary) 0%, rgba(247, 248, 251, 0.98) 100%)', backdropFilter: 'blur(20px)', borderTop: '1px solid var(--border-subtle)', padding: '12px 16px 28px', zIndex: 50 }}>
          <div style={{ display: 'flex', justifyContent: 'space-around', maxWidth: '500px', margin: '0 auto' }}>
            {tabs.map(tab => (
              <motion.button key={tab.id} onClick={() => setActiveTab(tab.id)} whileTap={{ scale: 0.9 }} whileHover={{ y: -2 }} style={{ background: 'none', border: 'none', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px', cursor: 'pointer', padding: '8px 12px', color: activeTab === tab.id ? 'var(--accent-purple)' : 'var(--text-muted)' }}>
                <motion.div animate={{ scale: activeTab === tab.id ? 1.1 : 1 }}>{tab.icon}</motion.div>
                <span style={{ fontSize: '11px', fontWeight: 500 }}>{tab.label}</span>
                {activeTab === tab.id && <motion.div layoutId="navDot" style={{ width: '4px', height: '4px', borderRadius: '50%', background: 'var(--accent-purple)' }} />}
              </motion.button>
            ))}
          </div>
        </nav>
      );
    };
    
    // ============ ADD TASK MODAL ============
    const AddAssignmentModal = ({ isOpen, onClose }) => {
      const { setAssignments, courses, assignmentTypes, statusOptions } = useData();
      const [form, setForm] = useState({ title: '', courseId: '', type: 'Homework', status: 'Not Started', dueDate: '', notes: '' });
      
      useEffect(() => {
        if (isOpen) setForm({ title: '', courseId: courses[0]?.id || '', type: 'Homework', status: 'Not Started', dueDate: new Date().toISOString().split('T')[0], notes: '' });
      }, [isOpen, courses]);
      
      const handleSubmit = (e) => {
        e.preventDefault();
        if (!form.title.trim()) return;
        setAssignments(prev => [...prev, { ...form, id: Date.now().toString() }]);
        onClose();
      };
      
      return (
        <Modal isOpen={isOpen} onClose={onClose} title="Add New Task">
          <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>
            <Input label="Title" placeholder="e.g., Read Chapter 5" value={form.title} onChange={(e) => setForm(f => ({ ...f, title: e.target.value }))} required />
            <Select label="Course" value={form.courseId} onChange={(e) => setForm(f => ({ ...f, courseId: e.target.value }))} options={courses.map(c => ({ value: c.id, label: `${c.code}` }))} />
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
              <Select label="Type" value={form.type} onChange={(e) => setForm(f => ({ ...f, type: e.target.value }))} options={assignmentTypes.map(t => ({ value: t, label: t }))} />
              <Select label="Status" value={form.status} onChange={(e) => setForm(f => ({ ...f, status: e.target.value }))} options={statusOptions.map(s => ({ value: s, label: s }))} />
            </div>
            <Input label="Due Date" type="date" value={form.dueDate} onChange={(e) => setForm(f => ({ ...f, dueDate: e.target.value }))} />
            <TextArea label="Notes (optional)" placeholder="Any details..." value={form.notes} onChange={(e) => setForm(f => ({ ...f, notes: e.target.value }))} />
            <div style={{ display: 'flex', gap: '12px', marginTop: '8px' }}>
              <Button type="button" variant="secondary" onClick={onClose} style={{ flex: 1 }}>Cancel</Button>
              <Button type="submit" style={{ flex: 1 }}>Add Task</Button>
            </div>
          </form>
        </Modal>
      );
    };
    
    // ============ DASHBOARD ============
    const Dashboard = ({ setActiveTab, showAddModal, setShowAddModal }) => {
      const { assignments, courses } = useData();
      const today = new Date();
      const upcoming = assignments.filter(a => a.status !== 'Complete' && a.status !== 'Submitted' && new Date(a.dueDate) >= today).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)).slice(0, 5);
      const overdue = assignments.filter(a => new Date(a.dueDate) < today && a.status !== 'Complete' && a.status !== 'Submitted');
      const completed = assignments.filter(a => a.status === 'Complete' || a.status === 'Submitted').length;
      const inProgress = assignments.filter(a => a.status === 'In Progress').length;
      const getCourse = (id) => courses.find(c => c.id === id) || { code: '???', color: '#71717a' };
      const formatDate = (date) => { const d = new Date(date); const diff = Math.ceil((d - today) / (1000 * 60 * 60 * 24)); if (diff === 0) return 'Today'; if (diff === 1) return 'Tomorrow'; if (diff < 7) return `${diff} days`; return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }); };
      
      return (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} style={{ padding: '24px 20px 120px' }}>
          <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} style={{ marginBottom: '32px' }}>
            <p style={{ color: 'var(--text-muted)', fontSize: '14px', marginBottom: '4px' }}>{today.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
            <h1 style={{ fontFamily: "'Fraunces', serif", fontSize: '32px', fontWeight: 700, background: 'linear-gradient(135deg, var(--text-primary) 0%, var(--accent-purple) 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '4px' }}>
              <TypewriterText text="Hey, Ketaki ‚ú®" delay={200} speed={50} />
            </h1>
            <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1.2 }} style={{ color: 'var(--text-secondary)', fontSize: '15px' }}>{upcoming.length > 0 ? `You have ${upcoming.length} upcoming ${upcoming.length === 1 ? 'task' : 'tasks'}` : "You're all caught up!"}</motion.p>
          </motion.div>
          
          <StaggerContainer>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '12px', marginBottom: '28px' }}>
              {[{ label: 'Overdue', value: overdue.length, color: '#f7a6a6', icon: '‚ö†Ô∏è' }, { label: 'In Progress', value: inProgress, color: '#a7d4ff', icon: 'üîÑ' }, { label: 'Completed', value: completed, color: '#a9e9d2', icon: '‚úì' }, { label: 'Total', value: assignments.length, color: '#c9b6ff', icon: 'üìö' }].map((stat) => (
                <StaggerItem key={stat.label}>
                  <Card style={{ padding: '18px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                      <div>
                        <motion.p initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: "spring", delay: 0.2 }} style={{ fontSize: '28px', fontWeight: 700, color: stat.color, fontFamily: "'Fraunces', serif" }}>{stat.value}</motion.p>
                        <p style={{ fontSize: '12px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.5px', marginTop: '4px' }}>{stat.label}</p>
                      </div>
                      <motion.span animate={{ rotate: [0, 10, -10, 0] }} transition={{ duration: 0.5, delay: 0.4 }} style={{ fontSize: '20px' }}>{stat.icon}</motion.span>
                    </div>
                  </Card>
                </StaggerItem>
              ))}
            </div>
          </StaggerContainer>
          
          {overdue.length > 0 && (
            <FadeInView delay={0.2}>
              <motion.div animate={{ boxShadow: ['0 0 0 0 rgba(248,113,113,0)', '0 0 20px 5px rgba(248,113,113,0.2)', '0 0 0 0 rgba(248,113,113,0)'] }} transition={{ duration: 2, repeat: Infinity }} style={{ background: 'linear-gradient(135deg, rgba(248,113,113,0.15) 0%, rgba(248,113,113,0.05) 100%)', borderRadius: 'var(--radius-lg)', border: '1px solid rgba(248,113,113,0.3)', padding: '16px 20px', marginBottom: '28px', display: 'flex', alignItems: 'center', gap: '12px' }}>
                <motion.span animate={{ scale: [1, 1.2, 1] }} transition={{ duration: 1, repeat: Infinity }} style={{ fontSize: '24px' }}>üî•</motion.span>
                <div><p style={{ fontWeight: 600, color: '#f7a6a6', marginBottom: '2px' }}>{overdue.length} overdue {overdue.length === 1 ? 'task' : 'tasks'}</p><p style={{ fontSize: '13px', color: 'var(--text-muted)' }}>Don't worry, you've got this!</p></div>
              </motion.div>
            </FadeInView>
          )}
          
          <FadeInView delay={0.3}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
              <h2 style={{ fontFamily: "'Fraunces', serif", fontSize: '18px', fontWeight: 600 }}>Coming Up</h2>
              <Button variant="ghost" size="sm" onClick={() => setActiveTab('assignments')}>View All</Button>
            </div>
            
            {upcoming.length === 0 ? (
              <Card style={{ padding: '40px 20px', textAlign: 'center' }}>
                <motion.span animate={{ y: [0, -10, 0] }} transition={{ duration: 1, repeat: Infinity }} style={{ fontSize: '48px', display: 'block', marginBottom: '12px' }}>üéâ</motion.span>
                <p style={{ color: 'var(--text-secondary)' }}>No upcoming tasks!</p>
                <Button variant="secondary" size="sm" style={{ marginTop: '16px' }} onClick={() => setShowAddModal(true)}>{Icons.plus} Add Task</Button>
              </Card>
            ) : (
              <CardStack>
                {upcoming.map((task) => { const course = getCourse(task.courseId); return (
                  <Card key={task.id} style={{ padding: '16px 18px', display: 'flex', alignItems: 'center', gap: '14px', borderLeft: `3px solid ${course.color}` }}>
                    <div style={{ width: '42px', height: '42px', borderRadius: 'var(--radius-md)', background: `${course.color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '18px', flexShrink: 0 }}>{task.type === 'Reading' ? 'üìñ' : task.type === 'Homework' ? 'üìù' : task.type === 'Exam' ? 'üìã' : task.type === 'Project' ? 'üöÄ' : 'üìÑ'}</div>
                    <div style={{ flex: 1, minWidth: 0 }}><p style={{ fontWeight: 600, fontSize: '14px', marginBottom: '4px', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{task.title}</p><div style={{ display: 'flex', alignItems: 'center', gap: '8px', fontSize: '12px', color: 'var(--text-muted)' }}><span style={{ color: course.color }}>{course.code}</span><span>‚Ä¢</span><span>{task.type}</span></div></div>
                    <div style={{ textAlign: 'right', flexShrink: 0 }}><p style={{ fontSize: '13px', fontWeight: 600, color: new Date(task.dueDate) <= today ? '#f7a6a6' : 'var(--text-primary)' }}>{formatDate(task.dueDate)}</p><StatusBadge status={task.status} /></div>
                  </Card>
                ); })}
              </CardStack>
            )}
          </FadeInView>
          
          <FadeInView delay={0.5}>
            <h2 style={{ fontFamily: "'Fraunces', serif", fontSize: '18px', fontWeight: 600, marginBottom: '16px', marginTop: '28px' }}>Quick Actions</h2>
            <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
              <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}><Button variant="secondary" onClick={() => setShowAddModal(true)}>{Icons.plus} Add Task</Button></motion.div>
              <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}><Button variant="secondary" onClick={() => setActiveTab('jobprep')}>{Icons.briefcase} Career Prep</Button></motion.div>
              <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}><Button variant="secondary" onClick={() => setActiveTab('grades')}>{Icons.chart} Grades</Button></motion.div>
            </div>
          </FadeInView>
          
          <AddAssignmentModal isOpen={showAddModal} onClose={() => setShowAddModal(false)} />
        </motion.div>
      );
    };
    
    // ============ ASSIGNMENTS PAGE ============
    const AssignmentsPage = ({ showAddModal, setShowAddModal }) => {
      const { assignments, setAssignments, courses, assignmentTypes, statusOptions } = useData();
      const [filter, setFilter] = useState({ course: 'all', type: 'all', status: 'all' });
      const [search, setSearch] = useState('');
      
      const getCourse = (id) => courses.find(c => c.id === id) || { code: '???', color: '#71717a' };
      const filtered = assignments.filter(a => (filter.course === 'all' || a.courseId === filter.course) && (filter.type === 'all' || a.type === filter.type) && (filter.status === 'all' || a.status === filter.status) && (!search || a.title.toLowerCase().includes(search.toLowerCase()))).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
      const grouped = assignmentTypes.reduce((acc, type) => { const items = filtered.filter(a => a.type === type); if (items.length > 0) acc[type] = items; return acc; }, {});
      
      return (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} style={{ padding: '24px 20px 120px' }}>
          <motion.h1 initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} style={{ fontFamily: "'Fraunces', serif", fontSize: '28px', fontWeight: 700, marginBottom: '24px' }}>Assignments</motion.h1>
          
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} style={{ display: 'flex', gap: '12px', marginBottom: '20px' }}>
            <div style={{ flex: 1, position: 'relative' }}><div style={{ position: 'absolute', left: '14px', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-muted)' }}>{Icons.search}</div><input placeholder="Search tasks..." value={search} onChange={(e) => setSearch(e.target.value)} style={{ width: '100%', background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '12px 16px 12px 44px', color: 'var(--text-primary)', fontSize: '14px', fontFamily: 'inherit', outline: 'none' }} /></div>
            <Button onClick={() => setShowAddModal(true)}>{Icons.plus}</Button>
          </motion.div>
          
          <div style={{ display: 'flex', gap: '8px', marginBottom: '24px', overflowX: 'auto', paddingBottom: '8px' }}>
            <select value={filter.course} onChange={(e) => setFilter(f => ({ ...f, course: e.target.value }))} style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '8px 12px', color: 'var(--text-primary)', fontSize: '13px', fontFamily: 'inherit', cursor: 'pointer' }}><option value="all">All Courses</option>{courses.map(c => <option key={c.id} value={c.id}>{c.code}</option>)}</select>
            <select value={filter.type} onChange={(e) => setFilter(f => ({ ...f, type: e.target.value }))} style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '8px 12px', color: 'var(--text-primary)', fontSize: '13px', fontFamily: 'inherit', cursor: 'pointer' }}><option value="all">All Types</option>{assignmentTypes.map(t => <option key={t} value={t}>{t}</option>)}</select>
            <select value={filter.status} onChange={(e) => setFilter(f => ({ ...f, status: e.target.value }))} style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '8px 12px', color: 'var(--text-primary)', fontSize: '13px', fontFamily: 'inherit', cursor: 'pointer' }}><option value="all">All Status</option>{statusOptions.map(s => <option key={s} value={s}>{s}</option>)}</select>
          </div>
          
          {Object.keys(grouped).length === 0 ? (
            <Card style={{ padding: '60px 20px', textAlign: 'center' }}><motion.span animate={{ rotate: [0, 10, -10, 0] }} transition={{ duration: 2, repeat: Infinity }} style={{ fontSize: '56px', display: 'block', marginBottom: '16px' }}>üìö</motion.span><p style={{ color: 'var(--text-secondary)' }}>No assignments found</p></Card>
          ) : (
            Object.entries(grouped).map(([type, tasks], gi) => (
              <FadeInView key={type} delay={gi * 0.1}>
                <div style={{ marginBottom: '28px' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}><span style={{ fontSize: '18px' }}>{type === 'Reading' ? 'üìñ' : type === 'Homework' ? 'üìù' : type === 'Exam' ? 'üìã' : type === 'Project' ? 'üöÄ' : type === 'Quiz' ? '‚ùì' : 'üìÑ'}</span><h3 style={{ fontFamily: "'Fraunces', serif", fontSize: '16px', fontWeight: 600 }}>{type}</h3><span style={{ fontSize: '12px', color: 'var(--text-muted)', background: 'var(--bg-tertiary)', padding: '2px 8px', borderRadius: '10px' }}>{tasks.length}</span></div>
                  <CardStack>
                    {tasks.map((task) => { const course = getCourse(task.courseId); const isOverdue = new Date(task.dueDate) < new Date() && task.status !== 'Complete' && task.status !== 'Submitted'; const done = task.status === 'Complete' || task.status === 'Submitted'; return (
                      <Card key={task.id} style={{ padding: '14px 16px', borderLeft: `3px solid ${course.color}`, opacity: done ? 0.6 : 1 }}>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                          <motion.button whileHover={{ scale: 1.1 }} whileTap={{ scale: 0.9 }} onClick={() => setAssignments(prev => prev.map(a => a.id === task.id ? { ...a, status: done ? 'Not Started' : 'Complete' } : a))} style={{ width: '22px', height: '22px', borderRadius: '6px', border: done ? 'none' : '2px solid var(--border-medium)', background: done ? 'var(--accent-green)' : 'transparent', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', flexShrink: 0, marginTop: '2px' }}>{done && Icons.check}</motion.button>
                          <div style={{ flex: 1, minWidth: 0 }}><p style={{ fontWeight: 600, fontSize: '14px', marginBottom: '6px', textDecoration: done ? 'line-through' : 'none', color: done ? 'var(--text-muted)' : 'var(--text-primary)' }}>{task.title}</p><div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}><span style={{ fontSize: '12px', color: course.color, fontWeight: 500 }}>{course.code}</span><span style={{ fontSize: '12px', color: isOverdue ? '#f7a6a6' : 'var(--text-muted)', display: 'flex', alignItems: 'center', gap: '4px' }}>{Icons.clock}{new Date(task.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}{isOverdue && ' (overdue)'}</span></div></div>
                          <motion.button whileHover={{ scale: 1.1 }} onClick={() => setAssignments(prev => prev.filter(a => a.id !== task.id))} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', padding: '6px' }}>{Icons.trash}</motion.button>
                        </div>
                      </Card>
                    ); })}
                  </CardStack>
                </div>
              </FadeInView>
            ))
          )}
          <AddAssignmentModal isOpen={showAddModal} onClose={() => setShowAddModal(false)} />
        </motion.div>
      );
    };
    
    // ============ CALENDAR ============
    const CalendarPage = () => {
      const { assignments, courses } = useData();
      const [currentDate, setCurrentDate] = useState(new Date());
      const getCourse = (id) => courses.find(c => c.id === id) || { color: '#71717a' };
      const year = currentDate.getFullYear(), month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1).getDay(), daysInMonth = new Date(year, month + 1, 0).getDate();
      const days = [...Array(firstDay).fill(null), ...Array.from({ length: daysInMonth }, (_, i) => i + 1)];
      const getForDay = (day) => day ? assignments.filter(a => a.dueDate === `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`) : [];
      const today = new Date();
      const isToday = (d) => d === today.getDate() && month === today.getMonth() && year === today.getFullYear();
      
      return (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} style={{ padding: '24px 20px 120px' }}>
          <motion.h1 initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} style={{ fontFamily: "'Fraunces', serif", fontSize: '28px', fontWeight: 700, marginBottom: '24px' }}>Calendar</motion.h1>
          <FadeInView><Card style={{ padding: '20px', marginBottom: '20px' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}><Button variant="ghost" onClick={() => setCurrentDate(new Date(year, month - 1, 1))}>‚Üê</Button><h2 style={{ fontFamily: "'Fraunces', serif", fontSize: '18px', fontWeight: 600 }}>{currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</h2><Button variant="ghost" onClick={() => setCurrentDate(new Date(year, month + 1, 1))}>‚Üí</Button></div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px', marginBottom: '8px' }}>{['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => <div key={i} style={{ textAlign: 'center', fontSize: '11px', fontWeight: 600, color: 'var(--text-muted)', padding: '8px 0' }}>{d}</div>)}</div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px' }}>{days.map((day, i) => { const da = getForDay(day); return <motion.div key={i} whileHover={day ? { scale: 1.1 } : {}} style={{ aspectRatio: '1', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', padding: '6px 2px', borderRadius: 'var(--radius-sm)', background: isToday(day) ? 'linear-gradient(135deg, var(--accent-purple) 0%, #818cf8 100%)' : day ? 'var(--bg-tertiary)' : 'transparent', cursor: day ? 'pointer' : 'default' }}>{day && <><span style={{ fontSize: '13px', fontWeight: isToday(day) ? 700 : 500, color: isToday(day) ? '#fff' : 'var(--text-primary)' }}>{day}</span>{da.length > 0 && <div style={{ display: 'flex', gap: '2px', marginTop: '4px' }}>{da.slice(0, 3).map((a, j) => <div key={j} style={{ width: '5px', height: '5px', borderRadius: '50%', background: getCourse(a.courseId).color }} />)}</div>}</>}</motion.div>; })}</div>
          </Card></FadeInView>
          <FadeInView delay={0.2}><h2 style={{ fontFamily: "'Fraunces', serif", fontSize: '18px', fontWeight: 600, marginBottom: '16px' }}>This Month</h2>{(() => { const ma = assignments.filter(a => { const d = new Date(a.dueDate); return d.getMonth() === month && d.getFullYear() === year; }).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)); return ma.length === 0 ? <Card style={{ padding: '40px 20px', textAlign: 'center' }}><p style={{ color: 'var(--text-muted)' }}>No tasks this month</p></Card> : <CardStack>{ma.map(t => { const c = getCourse(t.courseId); return <Card key={t.id} style={{ padding: '14px 16px', borderLeft: `3px solid ${c.color}` }}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}><div><p style={{ fontWeight: 600, fontSize: '14px', marginBottom: '4px' }}>{t.title}</p><p style={{ fontSize: '12px', color: 'var(--text-muted)' }}><span style={{ color: c.color }}>{courses.find(x => x.id === t.courseId)?.code}</span> ‚Ä¢ {t.type}</p></div><div style={{ textAlign: 'right' }}><p style={{ fontSize: '13px', fontWeight: 500 }}>{new Date(t.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</p><StatusBadge status={t.status} /></div></div></Card>; })}</CardStack>; })()}</FadeInView>
        </motion.div>
      );
    };
    
    // ============ JOB PREP ============
    const JobPrepPage = () => {
      const { jobPrep, setJobPrep } = useData();
      const [section, setSection] = useState('overview');
      const [showAdd, setShowAdd] = useState(null);
      
      const sections = [{ id: 'overview', label: 'Overview', icon: 'üìä' }, { id: 'applications', label: 'Apps', icon: 'üéØ' }, { id: 'study', label: 'Study', icon: 'üìö' }, { id: 'resumes', label: 'Resumes', icon: 'üìÑ' }];
      const addItem = (s, item) => { setJobPrep(p => ({ ...p, [s]: [...(p[s] || []), { ...item, id: Date.now().toString() }] })); setShowAdd(null); };
      const deleteItem = (s, id) => setJobPrep(p => ({ ...p, [s]: p[s].filter(x => x.id !== id) }));
      const updateItem = (s, id, u) => setJobPrep(p => ({ ...p, [s]: p[s].map(x => x.id === id ? { ...x, ...u } : x) }));
      
      return (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} style={{ padding: '24px 20px 120px' }}>
          <motion.h1 initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} style={{ fontFamily: "'Fraunces', serif", fontSize: '28px', fontWeight: 700, marginBottom: '8px' }}><TypewriterText text="Career Prep üíº" delay={100} speed={40} /></motion.h1>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.8 }} style={{ color: 'var(--text-muted)', marginBottom: '24px', fontSize: '14px' }}>Track your job search journey</motion.p>
          
          <div style={{ display: 'flex', gap: '8px', marginBottom: '24px', overflowX: 'auto', paddingBottom: '8px' }}>{sections.map((s, i) => <motion.button key={s.id} onClick={() => setSection(s.id)} whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: i * 0.05 }} style={{ background: section === s.id ? 'linear-gradient(135deg, var(--accent-purple) 0%, #818cf8 100%)' : 'var(--bg-tertiary)', border: '1px solid', borderColor: section === s.id ? 'transparent' : 'var(--border-medium)', borderRadius: 'var(--radius-md)', padding: '10px 16px', color: section === s.id ? '#fff' : 'var(--text-secondary)', fontSize: '13px', fontWeight: 500, fontFamily: 'inherit', cursor: 'pointer', whiteSpace: 'nowrap', display: 'flex', alignItems: 'center', gap: '6px' }}><span>{s.icon}</span>{s.label}</motion.button>)}</div>
          
          {section === 'overview' && <StaggerContainer><div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '12px', marginBottom: '24px' }}>{[{ label: 'Applications', count: jobPrep.applications?.length || 0, color: '#ffcaa3' }, { label: 'Study Topics', count: jobPrep.studyTopics?.length || 0, color: '#c9b6ff' }, { label: 'Resumes', count: jobPrep.resumes?.length || 0, color: '#a7d4ff' }, { label: 'Letters', count: jobPrep.coverLetters?.length || 0, color: '#a9e9d2' }].map(st => <StaggerItem key={st.label}><Card style={{ padding: '18px' }}><p style={{ fontSize: '28px', fontWeight: 700, color: st.color, fontFamily: "'Fraunces', serif" }}>{st.count}</p><p style={{ fontSize: '12px', color: 'var(--text-muted)', textTransform: 'uppercase' }}>{st.label}</p></Card></StaggerItem>)}</div></StaggerContainer>}
          
          {section === 'applications' && <FadeInView><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}><h3 style={{ fontFamily: "'Fraunces', serif", fontSize: '16px', fontWeight: 600 }}>Applications</h3><Button size="sm" onClick={() => setShowAdd('applications')}>{Icons.plus} Add</Button></div>{(jobPrep.applications?.length || 0) === 0 ? <Card style={{ padding: '40px 20px', textAlign: 'center' }}><motion.span animate={{ y: [0, -5, 0] }} transition={{ duration: 1, repeat: Infinity }} style={{ fontSize: '40px', display: 'block', marginBottom: '12px' }}>üéØ</motion.span><p style={{ color: 'var(--text-muted)' }}>No applications yet</p></Card> : <CardStack>{jobPrep.applications.map(app => <Card key={app.id} style={{ padding: '16px' }}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}><div style={{ flex: 1 }}><p style={{ fontWeight: 600, fontSize: '15px', marginBottom: '4px' }}>{app.company}</p><p style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '8px' }}>{app.position}</p><Badge color={app.status === 'Applied' ? '#a7d4ff' : app.status === 'Interview' ? '#a9e9d2' : app.status === 'Offer' ? '#c9b6ff' : app.status === 'Rejected' ? '#f7a6a6' : '#71717a'}>{app.status}</Badge></div><div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}><select value={app.status} onChange={(e) => updateItem('applications', app.id, { status: e.target.value })} style={{ background: 'var(--bg-tertiary)', border: '1px solid var(--border-medium)', borderRadius: 'var(--radius-sm)', padding: '4px 8px', color: 'var(--text-primary)', fontSize: '11px', fontFamily: 'inherit', cursor: 'pointer' }}><option value="Wishlist">Wishlist</option><option value="Applied">Applied</option><option value="Interview">Interview</option><option value="Offer">Offer</option><option value="Rejected">Rejected</option></select><motion.button whileHover={{ scale: 1.1 }} onClick={() => deleteItem('applications', app.id)} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', padding: '4px', alignSelf: 'flex-end' }}>{Icons.trash}</motion.button></div></div></Card>)}</CardStack>}</FadeInView>}
          
          {section === 'study' && <FadeInView><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}><h3 style={{ fontFamily: "'Fraunces', serif", fontSize: '16px', fontWeight: 600 }}>Study Topics</h3><Button size="sm" onClick={() => setShowAdd('studyTopics')}>{Icons.plus} Add</Button></div>{(jobPrep.studyTopics?.length || 0) === 0 ? <Card style={{ padding: '40px 20px', textAlign: 'center' }}><span style={{ fontSize: '40px', display: 'block', marginBottom: '12px' }}>üìö</span><p style={{ color: 'var(--text-muted)' }}>No study topics yet</p></Card> : <CardStack>{jobPrep.studyTopics.map(t => <Card key={t.id} style={{ padding: '16px' }}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}><div style={{ flex: 1 }}><div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '6px' }}><motion.button whileHover={{ scale: 1.1 }} onClick={() => updateItem('studyTopics', t.id, { completed: !t.completed })} style={{ width: '20px', height: '20px', borderRadius: '4px', border: t.completed ? 'none' : '2px solid var(--border-medium)', background: t.completed ? 'var(--accent-green)' : 'transparent', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff' }}>{t.completed && Icons.check}</motion.button><p style={{ fontWeight: 600, fontSize: '14px', textDecoration: t.completed ? 'line-through' : 'none', color: t.completed ? 'var(--text-muted)' : 'var(--text-primary)' }}>{t.name}</p></div><div style={{ display: 'flex', gap: '8px', marginLeft: '30px' }}><Badge color={t.category === 'DSA' ? '#a7d4ff' : t.category === 'System Design' ? '#a9e9d2' : t.category === 'ML' ? '#c9b6ff' : '#71717a'}>{t.category}</Badge><Badge color={t.priority === 'High' ? '#f7a6a6' : t.priority === 'Medium' ? '#ffe6a7' : '#71717a'}>{t.priority}</Badge></div></div><motion.button whileHover={{ scale: 1.1 }} onClick={() => deleteItem('studyTopics', t.id)} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', padding: '4px' }}>{Icons.trash}</motion.button></div></Card>)}</CardStack>}</FadeInView>}
          
          {section === 'resumes' && <FadeInView><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}><h3 style={{ fontFamily: "'Fraunces', serif", fontSize: '16px', fontWeight: 600 }}>Resumes</h3><Button size="sm" onClick={() => setShowAdd('resumes')}>{Icons.plus} Add</Button></div>{(jobPrep.resumes?.length || 0) === 0 ? <Card style={{ padding: '40px 20px', textAlign: 'center' }}><span style={{ fontSize: '40px', display: 'block', marginBottom: '12px' }}>üìÑ</span><p style={{ color: 'var(--text-muted)' }}>No resumes yet</p></Card> : <CardStack>{jobPrep.resumes.map(r => <Card key={r.id} style={{ padding: '16px' }}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}><div><p style={{ fontWeight: 600, fontSize: '14px', marginBottom: '4px' }}>{r.name}</p><p style={{ fontSize: '12px', color: 'var(--text-muted)' }}>{r.targetRole || 'General'}</p></div><motion.button whileHover={{ scale: 1.1 }} onClick={() => deleteItem('resumes', r.id)} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', padding: '4px' }}>{Icons.trash}</motion.button></div></Card>)}</CardStack>}</FadeInView>}
          
          <AddJobPrepModal isOpen={!!showAdd} onClose={() => setShowAdd(null)} section={showAdd} onAdd={addItem} />
        </motion.div>
      );
    };
    
    const AddJobPrepModal = ({ isOpen, onClose, section, onAdd }) => {
      const [form, setForm] = useState({});
      useEffect(() => { setForm({}); }, [section]);
      const handleSubmit = (e) => { e.preventDefault(); onAdd(section, form); };
      const titles = { resumes: 'Add Resume', applications: 'Add Application', studyTopics: 'Add Study Topic' };
      
      return (
        <Modal isOpen={isOpen} onClose={onClose} title={titles[section] || 'Add Item'}>
          <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>
            {section === 'resumes' && <><Input label="Resume Name" placeholder="e.g., SWE Resume v2" value={form.name || ''} onChange={(e) => setForm(f => ({ ...f, name: e.target.value }))} required /><Input label="Target Role" placeholder="e.g., ML Engineer" value={form.targetRole || ''} onChange={(e) => setForm(f => ({ ...f, targetRole: e.target.value }))} /></>}
            {section === 'applications' && <><Input label="Company" placeholder="e.g., Snowflake" value={form.company || ''} onChange={(e) => setForm(f => ({ ...f, company: e.target.value }))} required /><Input label="Position" placeholder="e.g., ML Engineer Intern" value={form.position || ''} onChange={(e) => setForm(f => ({ ...f, position: e.target.value }))} required /><div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}><Select label="Status" value={form.status || 'Wishlist'} onChange={(e) => setForm(f => ({ ...f, status: e.target.value }))} options={[{ value: 'Wishlist', label: 'Wishlist' }, { value: 'Applied', label: 'Applied' }, { value: 'Interview', label: 'Interview' }, { value: 'Offer', label: 'Offer' }, { value: 'Rejected', label: 'Rejected' }]} /><Input label="Date Applied" type="date" value={form.dateApplied || ''} onChange={(e) => setForm(f => ({ ...f, dateApplied: e.target.value }))} /></div></>}
            {section === 'studyTopics' && <><Input label="Topic" placeholder="e.g., Dynamic Programming" value={form.name || ''} onChange={(e) => setForm(f => ({ ...f, name: e.target.value }))} required /><div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}><Select label="Category" value={form.category || 'DSA'} onChange={(e) => setForm(f => ({ ...f, category: e.target.value }))} options={[{ value: 'DSA', label: 'DSA' }, { value: 'System Design', label: 'System Design' }, { value: 'ML', label: 'ML' }, { value: 'Behavioral', label: 'Behavioral' }, { value: 'Other', label: 'Other' }]} /><Select label="Priority" value={form.priority || 'Medium'} onChange={(e) => setForm(f => ({ ...f, priority: e.target.value }))} options={[{ value: 'High', label: 'High' }, { value: 'Medium', label: 'Medium' }, { value: 'Low', label: 'Low' }]} /></div></>}
            <div style={{ display: 'flex', gap: '12px', marginTop: '8px' }}><Button type="button" variant="secondary" onClick={onClose} style={{ flex: 1 }}>Cancel</Button><Button type="submit" style={{ flex: 1 }}>Add</Button></div>
          </form>
        </Modal>
      );
    };
    
    // ============ GRADES ============
    const GradesPage = () => {
      const { courses, grades, setGrades } = useData();
      const [showAdd, setShowAdd] = useState(false);
      const gpa = () => { if (grades.length === 0) return '0.00'; const pts = { 'A+': 4.0, 'A': 4.0, 'A-': 3.7, 'B+': 3.3, 'B': 3.0, 'B-': 2.7, 'C+': 2.3, 'C': 2.0, 'C-': 1.7, 'D+': 1.3, 'D': 1.0, 'D-': 0.7, 'F': 0.0 }; let tp = 0, tc = 0; grades.forEach(g => { tp += (pts[g.grade] || 0) * (parseFloat(g.credits) || 3); tc += parseFloat(g.credits) || 3; }); return tc > 0 ? (tp / tc).toFixed(2) : '0.00'; };
      const getCourse = (id) => courses.find(c => c.id === id) || { code: '???', name: 'Unknown', color: '#71717a' };
      
      return (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} style={{ padding: '24px 20px 120px' }}>
          <motion.h1 initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} style={{ fontFamily: "'Fraunces', serif", fontSize: '28px', fontWeight: 700, marginBottom: '24px' }}>Grades</motion.h1>
          <FadeInView><Card style={{ padding: '32px', textAlign: 'center', marginBottom: '24px', background: 'linear-gradient(135deg, rgba(167,139,250,0.15) 0%, rgba(96,165,250,0.1) 100%)' }}><p style={{ fontSize: '14px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' }}>Cumulative GPA</p><motion.p initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: "spring", delay: 0.2 }} style={{ fontSize: '56px', fontWeight: 700, fontFamily: "'Fraunces', serif", background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '8px' }}>{gpa()}</motion.p><p style={{ fontSize: '13px', color: 'var(--text-muted)' }}>Based on {grades.length} courses</p></Card></FadeInView>
          <FadeInView delay={0.2}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}><h2 style={{ fontFamily: "'Fraunces', serif", fontSize: '18px', fontWeight: 600 }}>Course Grades</h2><Button size="sm" onClick={() => setShowAdd(true)}>{Icons.plus} Add</Button></div>{grades.length === 0 ? <Card style={{ padding: '40px 20px', textAlign: 'center' }}><motion.span animate={{ y: [0, -5, 0] }} transition={{ duration: 1, repeat: Infinity }} style={{ fontSize: '48px', display: 'block', marginBottom: '12px' }}>üìä</motion.span><p style={{ color: 'var(--text-muted)' }}>No grades yet</p></Card> : <CardStack>{grades.map((g) => { const c = getCourse(g.courseId); return <Card key={g.id} style={{ padding: '16px', borderLeft: `3px solid ${c.color}` }}><div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}><div><p style={{ fontWeight: 600, fontSize: '14px', marginBottom: '4px' }}>{c.code}</p><p style={{ fontSize: '12px', color: 'var(--text-muted)' }}>{c.name}</p></div><div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}><div style={{ textAlign: 'right' }}><motion.p initial={{ scale: 0 }} animate={{ scale: 1 }} style={{ fontSize: '24px', fontWeight: 700, fontFamily: "'Fraunces', serif", color: g.grade.startsWith('A') ? '#a9e9d2' : g.grade.startsWith('B') ? '#a7d4ff' : g.grade.startsWith('C') ? '#ffe6a7' : '#f7a6a6' }}>{g.grade}</motion.p><p style={{ fontSize: '11px', color: 'var(--text-muted)' }}>{g.credits} cr</p></div><motion.button whileHover={{ scale: 1.1 }} onClick={() => setGrades(p => p.filter(x => x.id !== g.id))} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer', padding: '4px' }}>{Icons.trash}</motion.button></div></div></Card>; })}</CardStack>}</FadeInView>
          <AddGradeModal isOpen={showAdd} onClose={() => setShowAdd(false)} />
        </motion.div>
      );
    };
    
    const AddGradeModal = ({ isOpen, onClose }) => {
      const { courses, setGrades } = useData();
      const [form, setForm] = useState({ courseId: '', grade: 'A', credits: '3' });
      useEffect(() => { if (isOpen) setForm({ courseId: courses[0]?.id || '', grade: 'A', credits: '3' }); }, [isOpen, courses]);
      const handleSubmit = (e) => { e.preventDefault(); setGrades(p => [...p, { ...form, id: Date.now().toString() }]); onClose(); };
      const gradeOpts = ['A+', 'A', 'A-', 'B+', 'B', 'B-', 'C+', 'C', 'C-', 'D+', 'D', 'D-', 'F'];
      
      return (
        <Modal isOpen={isOpen} onClose={onClose} title="Add Grade">
          <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>
            <Select label="Course" value={form.courseId} onChange={(e) => setForm(f => ({ ...f, courseId: e.target.value }))} options={courses.map(c => ({ value: c.id, label: c.code }))} />
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}><Select label="Grade" value={form.grade} onChange={(e) => setForm(f => ({ ...f, grade: e.target.value }))} options={gradeOpts.map(g => ({ value: g, label: g }))} /><Input label="Credits" type="number" min="1" max="6" value={form.credits} onChange={(e) => setForm(f => ({ ...f, credits: e.target.value }))} /></div>
            <div style={{ display: 'flex', gap: '12px', marginTop: '8px' }}><Button type="button" variant="secondary" onClick={onClose} style={{ flex: 1 }}>Cancel</Button><Button type="submit" style={{ flex: 1 }}>Add</Button></div>
          </form>
        </Modal>
      );
    };
    
    // ============ APP ============
    const App = () => {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [showAddModal, setShowAddModal] = useState(false);
      
      return (
        <DataProvider>
          <div style={{ minHeight: '100vh', background: 'var(--bg-primary)', position: 'relative' }}>
            <motion.div
              animate={{ opacity: [0.6, 0.9, 0.6], scale: [1, 1.03, 1] }}
              transition={{ duration: 10, repeat: Infinity, ease: "easeInOut" }}
              style={{ position: 'fixed', top: 0, left: 0, right: 0, height: '420px', background: 'radial-gradient(ellipse at top, rgba(201, 182, 255, 0.12) 0%, transparent 70%)', pointerEvents: 'none', zIndex: 0 }}
            />
            <main style={{ position: 'relative', zIndex: 1 }}>
              <AnimatePresence mode="wait">
                {activeTab === 'dashboard' && <Dashboard key="d" setActiveTab={setActiveTab} showAddModal={showAddModal} setShowAddModal={setShowAddModal} />}
                {activeTab === 'assignments' && <AssignmentsPage key="a" showAddModal={showAddModal} setShowAddModal={setShowAddModal} />}
                {activeTab === 'calendar' && <CalendarPage key="c" />}
                {activeTab === 'jobprep' && <JobPrepPage key="j" />}
                {activeTab === 'grades' && <GradesPage key="g" />}
              </AnimatePresence>
            </main>
            <Navigation activeTab={activeTab} setActiveTab={setActiveTab} />
          </div>
        </DataProvider>
      );
    };
    
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
